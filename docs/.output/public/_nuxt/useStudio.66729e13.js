import{ah as v,J as w,ac as P,ar as g,as as y,at as x,m as C,au as R,aq as U}from"./entry.a3eeb5c2.js";import _ from"./ContentPreviewMode.d997095e.js";/* empty css                                                                           */const I=(h,r,d)=>{const s=[...r||[]],c=[...d||[]],i=[...h||[]];for(const e of s)if(e.oldPath)if(c.splice(c.findIndex(a=>a.path===e.oldPath),1),s.find(a=>a.path===e.oldPath))i.push({path:e.path,parsed:e.parsed});else{const a=i.find(t=>t.path===e.oldPath);a&&(a.path=e.path,e.parsed?a.parsed=e.parsed:e.pathMeta&&["_file","_path","_id","_locale"].forEach(t=>{a.parsed[t]=e.pathMeta[t]}))}else if(e.new)i.push({path:e.path,parsed:e.parsed});else{const n=i.find(a=>a.path===e.path);n&&Object.assign(n,{path:e.path,parsed:e.parsed})}for(const e of c)i.splice(i.findIndex(n=>n.path===e.path),1);return i},L=h=>{let r;return(...d)=>(r||(r=h()),r)},S=L(()=>{const h=v(),r={...w()},d=P().public.studio||{},s=g("previewToken",{sameSite:"none",secure:!0}),c=async(t,o,p=!0)=>{const m=await t.getKeys(`${s.value}:`);await Promise.all(m.map(u=>t.removeItem(u))),await t.setItem(`${s.value}$`,JSON.stringify({ignoreBuiltContents:p})),await Promise.all(o.map(u=>{var l;return t.setItem(`${s.value}:${(l=u.parsed)==null?void 0:l._id}`,JSON.stringify(u.parsed))}))},i=t=>{y(h,x,[t||r])},e=async t=>{const o=await $fetch("api/projects/preview",{baseURL:d.apiURL,params:{token:s.value}}),p=I(o.files,o.additions,o.deletions),m=p.filter(f=>f.path.startsWith("content"));await c(t,m,(o.files||[]).length!==0);const l=p.filter(f=>f.path.startsWith(".studio")).find(f=>f.path===".studio/app.config.json");i(l==null?void 0:l.parsed)},n=async()=>{await $fetch("api/projects/preview/sync",{baseURL:d.apiURL,method:"POST",params:{token:s.value}})},a=t=>{const o=C(()=>!!t.value),p=document.createElement("div");p.id="__nuxt_preview_wrapper",document.body.appendChild(p),R(_,{previewToken:s,apiURL:d.apiURL,storageReady:o,refresh:()=>e(t.value).then(()=>U()),init:n}).mount(p)};return{apiURL:d.apiURL,previewToken:s,syncPreview:e,syncPreviewFiles:c,syncPreviewAppConfig:i,requestPreviewSynchronization:n,mountPreviewUI:a}});export{S as useStudio};
